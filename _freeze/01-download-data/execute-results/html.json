{
  "hash": "077a5912b56330e54781629d236791d5",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute:\n  cache: false\n---\n\n\n\n\n# Download Data {#sec-download-data}\n\n\n\n\n\n\n\n\n\n\n\n:::::: {#obj-chapter-template}\n::::: my-objectives\n::: my-objectives-header\nMy objective for this chapter\n:::\n\n::: my-objectives-container\nIn this chapter, I will download all well-being data \nprovided by the different [World Happiness Reports\n2012-2025](https://worldhappiness.report/analysis/).\n:::\n:::::\n::::::\n\n\n\n\n## Introduction\n\nFrom the years 2012-2024 only data for one year was provided. For example, the World Happiness Report (<a class='glossary' title='The World Happiness Reports is a partnership of Gallup, the Oxford Wellbeing Research Centre, the UN Sustainable Development Solutions Network, and the WHR’s Editorial Board. The report is produced under the editorial control of the WHR Editorial Board. The Reports reflects a worldwide demand for more attention to happiness and well-being as criteria for government policy. It reviews the state of happiness in the world today and shows how the science of happiness explains personal and national variations in happiness. (https://worldhappiness.report/about/)'>WHR</a>) from 2012 included data from Gallup research conducted in 2011. However, starting with the 2025 report, all data are combined into a single dataset covering the years 2011 to 2024, with the exception of 2012 (as there was no report in 2013).\n\nFor the years 2011 to 2018, only the <a class='glossary' title='The Cantril Ladder is a visual scale used to assess general life satisfaction. It asks respondents to evaluate their lives on a ladder from worst (bottom) to best (top) possible life, making it a simple tool to measure subjective well-being. This measure has been widely used in various studies and surveys, including the Gallup World Poll, which collects data from over 140 countries annually.'>Cantril ladder</a> data along with country rankings are available. Beginning with 2019 (in the report published in 2020), the complete dataset is included. This full dataset contains the upper whisker/lower whisker data and the six presumed contributing factors for subjective well-being: log GDP per capita, social support, healthy life expectancy, freedom to make life choices, generosity, and perception of corruption. Additionally, it includes the residuals for \"<a class='glossary' title='In the context of the World Happiness Report (WHR), Dystopia is a hypothetical country used as a benchmark where each of the six factors—levels of Gross Domestic Product (GDP), life expectancy, generosity, social support, freedom, and corruption—score at the bottom, representing the world’s least-happy people. This imaginary country serves to compare real countries against a baseline of the lowest observed scores for these factors, allowing researchers to understand how much better or worse each country performs in terms of happiness. The concept of Dystopia contrasts with the idea of Utopia, an imagined society where life is perfect. Instead, Dystopia illustrates a society where conditions are as unfavorable as possible according to the six factors measured in the World Happiness Report'>dystopia</a>,\" an imaginary country representing the lowest scores for each of the six variables observed.\n\n## Folder and file oganization\n\nThe first step is to find the life-evaluation data for each year and to store the files for further R processing. I will store the files in the \"whr-cantril\" folder inside my \"data\" folder.\n\nThe `my_create_folder()` function in the following code chunk checks if the folder already exists. If this is the case it leaves it untouched, otherwise it creates the folder at the desired path. The code for this private function is in the file `helper.R` inside the `R` folder at root level of this working directory.\n\n:::::{.my-resource}\n:::{.my-resource-header}\n:::::: {#lem-folder-structure}\n: File Organization\n::::::\n:::\n::::{.my-resource-container}\n\nI will organize files into several sub folders:\n\n- **/data/**: main folder for all data files related to this project\n- **/data/whr-cantril/excel/**: untouched original Excel file(s) (to prevent possible link rot at the original source)\n- **/data/whr-cantril/rds/**: R objects of the original data of the Excel file(s)\n\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-create-whr-folder}\n: Create folders for data files of the World Happiness Reports\n::::::\n:::\n::::{.my-r-code-container}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nmy_create_folder(base::paste0(here::here(), \"/data/\"))\nmy_create_folder(base::paste0(here::here(), \"/data/whr-cantril/\"))\nmy_create_folder(base::paste0(here::here(), \"/data/whr-cantril/excel\"))\nmy_create_folder(base::paste0(here::here(), \"/data/whr-cantril/csv\"))\nmy_create_folder(base::paste0(here::here(), \"/data/whr-cantril/rds\"))\n```\n:::\n\n\n\n\n<center>(*For this R code chunk is no output available*)</center>\n\n\n::::\n:::::\n\n::::\n:::::\n\n\n:::::{.my-watch-out}\n:::{.my-watch-out-header}\nWATCH OUT! Excel file contains many hidden rows\n:::\n::::{.my-watch-out-container}\nA manual inspection of the Excel data file revealed that only the last year 2024 are shown. All the other years are hidden. But the `download.file()` functions saves all data, visible and hidden rows alike.\n\nHere I can't use the `downloader::download()` function because it does not save the hidden data.\n\nAt the same code chunk where I download the Excel file I will also [cache a CSV snapshot](https://readxl.tidyverse.org/articles/readxl-workflows.html#cache-a-csv-snapshot) for reproducibility reasons. \n::::\n:::::\n\n\n## Save data as Excel as \".csv\" files and as \".rds\" object\n\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-download-whr-data}\n: Save data for the World Happiness Reports 2011-2024 in different formats\n::::::\n:::\n::::{.my-r-code-container}\n\n\n<center>**Run this code chunk manually if the file still needs to be converted to an \".rds\" object.**</center>\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## WHR 2025 #########################################\nurl_excel <- base::paste0(\"https://happiness-report.s3.us-east-1.amazonaws.com/2025/\",\n    \"Data+for+Figure+2.1+(2011%E2%80%932024).xlsx\")\npath_excel <- base::paste0(here::here(), \n            \"/data/whr-cantril/excel/Data+for+Figure+2.1+(2011–2024).xlsx\")\npath_csv <- base::paste0(here::here(), \n            \"/data/whr-cantril/csv/Data+for+Figure+2.1+(2011–2024).csv\")\n\n\n# download Excel file\nutils::download.file(\n    url_excel, \n    destfile = path_excel\n    )\n\n# cache a CSV snapshot\nwhr_2011_2024 <- path_excel  |>  \n  readxl::read_excel() |>  \n  readr::write_csv(path_csv)\n\n# save a RDS R object\nmy_save_data_file(\"whr-cantril/rds\", whr_2011_2024, \"whr_2011_2024_orig.rds\")\n\n\n# download as .rds object, sorted by country name and year\nwhr_2011_2024_arrange <- dplyr::arrange(whr_2011_2024, `Country name`, Year)\nmy_save_data_file(\"whr-cantril/rds\", whr_2011_2024_arrange, \"whr_2011_2024_arrange.rds\")\n```\n:::\n\n\n\n\n\n<center>(*For this R code chunk is no output available*)</center>\n\n\n::::\n:::::\n\n\n## Inspect data\n\n::: {.my-code-collection}\n:::: {.my-code-collection-header}\n::::: {.my-code-collection-icon}\n:::::\n:::::: {#exm-01-inspect-data}\n: Inspect Cantril Ladder data 2011-2024\n::::::\n\n::::\n\n::::{.my-code-collection-container}\n\n::: {.panel-tabset}\n\n###### Show random data\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-01-show-random-cantril-ladder-data}\n: Show random Cantril Ladder data 2011-2024\n::::::\n:::\n::::{.my-r-code-container}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwhr_2011_2024_arrange <- base::readRDS(\"data/whr-cantril/rds/whr_2011_2024_arrange.rds\")\nmy_glance_data(whr_2011_2024_arrange)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 10 × 14\n#>      obs  Year  Rank `Country name` `Ladder score` upperwhisker lowerwhisker\n#>    <int> <dbl> <dbl> <chr>                   <dbl>        <dbl>        <dbl>\n#>  1     1  2011   131 Afghanistan              4.26        NA           NA   \n#>  2    49  2015    26 Argentina                6.65        NA           NA   \n#>  3   321  2018   132 Chad                     4.35        NA           NA   \n#>  4   561  2022   124 Ethiopia                 4.09         4.27         3.91\n#>  5   634  2024    22 Germany                  6.75         6.85         6.65\n#>  6  1098  2012    48 Malta                    5.96        NA           NA   \n#>  7  1170  2020    73 Montenegro               5.58         5.69         5.48\n#>  8  1177  2014    92 Morocco                  5.01        NA           NA   \n#>  9  1252  2014     9 New Zealand              7.29        NA           NA   \n#> 10  1969  2024   143 Zimbabwe                 3.40         3.51         3.28\n#> # ℹ 7 more variables: `Explained by: Log GDP per capita` <dbl>,\n#> #   `Explained by: Social support` <dbl>,\n#> #   `Explained by: Healthy life expectancy` <dbl>,\n#> #   `Explained by: Freedom to make life choices` <dbl>,\n#> #   `Explained by: Generosity` <dbl>,\n#> #   `Explained by: Perceptions of corruption` <dbl>,\n#> #   `Dystopia + residual` <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n\n::::\n:::::\n\n\n###### Glimpse\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-01-glimpse-data}\n: Glimpse cantril ladder data 2011-2024\n::::::\n:::\n::::{.my-r-code-container}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwhr_2011_2024_arrange <- base::readRDS(\"data/whr-cantril/rds/whr_2011_2024_arrange.rds\") |> \n  dplyr::glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Rows: 1,969\n#> Columns: 13\n#> $ Year                                         <dbl> 2011, 2012, 2014, 2015, 2…\n#> $ Rank                                         <dbl> 131, 143, 153, 154, 141, …\n#> $ `Country name`                               <chr> \"Afghanistan\", \"Afghanist…\n#> $ `Ladder score`                               <dbl> 4.2580, 4.0400, 3.5750, 3…\n#> $ upperwhisker                                 <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ lowerwhisker                                 <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Log GDP per capita`           <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Social support`               <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Healthy life expectancy`      <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Freedom to make life choices` <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Generosity`                   <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Explained by: Perceptions of corruption`    <dbl> NA, NA, NA, NA, NA, NA, N…\n#> $ `Dystopia + residual`                        <dbl> NA, NA, NA, NA, NA, NA, N…\n```\n\n\n:::\n:::\n\n\n\n\n\n::::\n:::::\n\n\n###### Skim\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-01-skim-data}\n: Skim cantril ladder data 2011-2024\n::::::\n:::\n::::{.my-r-code-container}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwhr_2011_2024_arrange <- base::readRDS(\"data/whr-cantril/rds/whr_2011_2024_arrange.rds\") |> \n  skimr::skim()\n```\n:::\n\n\n\n\n\n::::\n:::::\n\n:::\n\n::::\n:::::\n\n\nAfter inspection of the data we can summarize:\n\n- There are data for 169 countries. So we don't have data for all countries and territories by the [United Nations geoscheme](https://unstats.un.org/unsd/methodology/m49/) because this includes 193 UN member states, two UN observer states (the Holy See and the State of Palestine), two states in free association with New Zealand (the Cook Islands and Niue), and 49 non-sovereign dependencies or territories, as well as Western Sahara (a disputed territory whose sovereignty is contested) and Antarctica.\n- Furthermore the country names do not confirm in all instances to the official names of the M49 geoscheme. For instance we have Cyprus and North Cyprus or Somalia and Somaliland Region.\n- Not all of these countries have covered all years (2011-2024). For instance Cuba has covered only one year (2011).\n- For the years 2011 to 2018, only the <a class='glossary' title='The Cantril Ladder is a visual scale used to assess general life satisfaction. It asks respondents to evaluate their lives on a ladder from worst (bottom) to best (top) possible life, making it a simple tool to measure subjective well-being. This measure has been widely used in various studies and surveys, including the Gallup World Poll, which collects data from over 140 countries annually.'>Cantril ladder</a> data along with country rankings are available. Beginning with 2019 (in the report published in 2020), the complete dataset is included.\n\n\n## Glossary\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:left;\"> definition </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Cantril Ladder </td>\n   <td style=\"text-align:left;\"> The Cantril Ladder is a visual scale used to assess general life satisfaction. It asks respondents to evaluate their lives on a ladder from worst (bottom) to best (top) possible life, making it a simple tool to measure subjective well-being. This measure has been widely used in various studies and surveys, including the Gallup World Poll, which collects data from over 140 countries annually. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Dystopia </td>\n   <td style=\"text-align:left;\"> In the context of the World Happiness Report (WHR), Dystopia is a hypothetical country used as a benchmark where each of the six factors—levels of Gross Domestic Product (GDP), life expectancy, generosity, social support, freedom, and corruption—score at the bottom, representing the world’s least-happy people. This imaginary country serves to compare real countries against a baseline of the lowest observed scores for these factors, allowing researchers to understand how much better or worse each country performs in terms of happiness. The concept of Dystopia contrasts with the idea of Utopia, an imagined society where life is perfect. Instead, Dystopia illustrates a society where conditions are as unfavorable as possible according to the six factors measured in the World Happiness Report </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WHR </td>\n   <td style=\"text-align:left;\"> The World Happiness Reports is a partnership of Gallup, the Oxford Wellbeing Research Centre, the UN Sustainable Development Solutions Network, and the WHR’s Editorial Board. The report is produced under the editorial control of the WHR Editorial Board. The Reports reflects a worldwide demand for more attention to happiness and well-being as criteria for government policy. It reviews the state of happiness in the world today and shows how the science of happiness explains personal and national variations in happiness. (https://worldhappiness.report/about/) </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n------------------------------------------------------------------------\n\n## Session Info\n\n::::: my-r-code\n::: my-r-code-header\nSession Info\n:::\n\n::: my-r-code-container\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.4.3 (2025-02-28)\n#>  os       macOS Sequoia 15.3.2\n#>  system   aarch64, darwin20\n#>  ui       X11\n#>  language (EN)\n#>  collate  en_US.UTF-8\n#>  ctype    en_US.UTF-8\n#>  tz       Europe/Vienna\n#>  date     2025-04-06\n#>  pandoc   3.2 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)\n#>  quarto   1.6.42 @ /usr/local/bin/quarto\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────\n#>  package     * version date (UTC) lib source\n#>  base64enc     0.1-3   2015-07-28 [1] CRAN (R 4.4.1)\n#>  cli           3.6.4   2025-02-13 [1] CRAN (R 4.4.1)\n#>  colorspace    2.1-1   2024-07-26 [1] CRAN (R 4.4.1)\n#>  commonmark    1.9.2   2024-10-04 [1] CRAN (R 4.4.1)\n#>  curl          6.2.1   2025-02-19 [1] CRAN (R 4.4.1)\n#>  digest        0.6.37  2024-08-19 [1] CRAN (R 4.4.1)\n#>  dplyr         1.1.4   2023-11-17 [1] CRAN (R 4.4.0)\n#>  evaluate      1.0.3   2025-01-10 [1] CRAN (R 4.4.1)\n#>  fastmap       1.2.0   2024-05-15 [1] CRAN (R 4.4.1)\n#>  generics      0.1.3   2022-07-05 [1] CRAN (R 4.4.1)\n#>  glossary    * 1.0.0   2023-05-30 [1] CRAN (R 4.4.0)\n#>  glue          1.8.0   2024-09-30 [1] CRAN (R 4.4.1)\n#>  here          1.0.1   2020-12-13 [1] CRAN (R 4.4.1)\n#>  htmltools     0.5.8.1 2024-04-04 [1] CRAN (R 4.4.1)\n#>  htmlwidgets   1.6.4   2023-12-06 [1] CRAN (R 4.4.0)\n#>  jsonlite      1.9.1   2025-03-03 [1] CRAN (R 4.4.1)\n#>  kableExtra    1.4.0   2024-01-24 [1] CRAN (R 4.4.0)\n#>  knitr         1.49    2024-11-08 [1] CRAN (R 4.4.1)\n#>  lifecycle     1.0.4   2023-11-07 [1] CRAN (R 4.4.1)\n#>  magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.4.1)\n#>  markdown      1.13    2024-06-04 [1] CRAN (R 4.4.1)\n#>  munsell       0.5.1   2024-04-01 [1] CRAN (R 4.4.1)\n#>  pillar        1.10.1  2025-01-07 [1] CRAN (R 4.4.1)\n#>  pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.4.1)\n#>  purrr         1.0.4   2025-02-05 [1] CRAN (R 4.4.1)\n#>  R6            2.6.1   2025-02-15 [1] CRAN (R 4.4.1)\n#>  repr          1.1.7   2024-03-22 [1] CRAN (R 4.4.0)\n#>  rlang         1.1.5   2025-01-17 [1] CRAN (R 4.4.1)\n#>  rmarkdown     2.29    2024-11-04 [1] CRAN (R 4.4.1)\n#>  rprojroot     2.0.4   2023-11-05 [1] CRAN (R 4.4.1)\n#>  rstudioapi    0.17.1  2024-10-22 [1] CRAN (R 4.4.1)\n#>  rversions     2.1.2   2022-08-31 [1] CRAN (R 4.4.1)\n#>  scales        1.3.0   2023-11-28 [1] CRAN (R 4.4.0)\n#>  sessioninfo   1.2.3   2025-02-05 [1] CRAN (R 4.4.1)\n#>  skimr         2.1.5   2022-12-23 [1] CRAN (R 4.4.0)\n#>  stringi       1.8.4   2024-05-06 [1] CRAN (R 4.4.1)\n#>  stringr       1.5.1   2023-11-14 [1] CRAN (R 4.4.0)\n#>  svglite       2.1.3   2023-12-08 [1] CRAN (R 4.4.0)\n#>  systemfonts   1.2.1   2025-01-20 [1] CRAN (R 4.4.1)\n#>  tibble        3.2.1   2023-03-20 [1] CRAN (R 4.4.0)\n#>  tidyr         1.3.1   2024-01-24 [1] CRAN (R 4.4.1)\n#>  tidyselect    1.2.1   2024-03-11 [1] CRAN (R 4.4.0)\n#>  utf8          1.2.4   2023-10-22 [1] CRAN (R 4.4.1)\n#>  vctrs         0.6.5   2023-12-01 [1] CRAN (R 4.4.0)\n#>  viridisLite   0.4.2   2023-05-02 [1] CRAN (R 4.4.1)\n#>  withr         3.0.2   2024-10-28 [1] CRAN (R 4.4.1)\n#>  xfun          0.51    2025-02-19 [1] CRAN (R 4.4.1)\n#>  xml2          1.3.7   2025-02-28 [1] CRAN (R 4.4.1)\n#>  yaml          2.3.10  2024-07-26 [1] CRAN (R 4.4.1)\n#> \n#>  [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library\n#>  * ── Packages attached to the search path.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n\n\n:::\n:::::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}